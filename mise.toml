[tasks.ios-snapshots]
description = "Run all iOS snapshot tests on the booted simulator, record artifacts, and generate the HTML report."
run = [
  "bash scripts/run_ios_snapshots.sh all"
]

[tasks.ios-snapshots-htmlbasic]
description = "Run only HTMLBasicTests snapshots on the booted simulator, record artifacts, and regenerate the report."
run = [
  "bash scripts/run_ios_snapshots.sh htmlbasic"
]

[tasks.ios-snapshot-single]
description = "Run a single snapshot test (set TEST_ONLY to e.g. SwiftUIHTMLExampleTests/HTMLBasicTests/testHTMLImageWithLineHeight) and emit the mini report."
run = [
  "bash scripts/run_ios_snapshots.sh single"
]

[tasks.ios-snapshots-report]
description = "Generate HTML snapshot report from /tmp/swiftuihtml-ios-artifacts and include the last ios test log."
run = [
  "set -euo pipefail; python3 \"scripts/snapshot_report.py\" --artifacts \"/tmp/swiftuihtml-ios-artifacts/HTMLBasicTests\" --baseline \"SwiftUIHTMLExampleTests/__Snapshots__/HTMLBasicTests\" --title \"SwiftUIHTML iOS Snapshot Report\" --out-prefix \"/tmp/swiftuihtml-ios-snapshot-report\" --test-log \"/tmp/swiftuihtml-ios-xcodebuild.log\""
]

[tasks.macos-snapshots-report]
description = "Generate HTML snapshot report from the latest /tmp/swiftuihtml-macos-artifacts*"
run = [
  "set -euo pipefail; artifacts_root=$(ls -1dt /tmp/swiftuihtml-macos-artifacts-* /tmp/swiftuihtml-macos-artifacts 2>/dev/null | head -n 1 || true); if [ -z \"$artifacts_root\" ]; then echo \"No macOS snapshot artifacts found\"; exit 1; fi; python3 \"scripts/snapshot_report.py\" --artifacts \"$artifacts_root\" --baseline \"SwiftUIHTMLExampleTests/__Snapshots__/HTMLBasicTests\" --title \"SwiftUIHTML macOS Snapshot Report\" --out-prefix \"/tmp/swiftuihtml-macos-snapshot-report\""
]
